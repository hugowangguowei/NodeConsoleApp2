# 技能系统设计文档 (Skill System Design)

## 1. 技能综述 (Overview)

本游戏的技能系统构建于经典的 **西方奇幻 (Western Fantasy)** 背景之上。
技能是玩家与敌人交互的主要手段，也是构建角色流派 (Build) 的核心要素。

*   **核心理念**: 技能不仅仅是伤害输出的手段，更是策略执行的工具。
*   **技能类型**:
    *   **攻击型 (Offensive)**: 削减敌人 HP 或破坏护甲。
    *   **防御型 (Defensive)**: 增加临时护甲、格挡伤害或进行回复。
    *   **辅助/控制型 (Support/Control)**: 施加 Buff (增益) 或 Debuff (减益)，改变战斗节奏。
*   **资源消耗**: 当前实现以行动力 (AP) 为主，但在“一回合内配置多个技能组合释放”的玩法下，仅用 AP 无法完整表达约束；因此设计层面预留了“需求资源 / 消耗资源”的扩展模型（见 1.3）。

---

## 1.1 技能与 Buff 系统的对接规范（重要）

本节用于把 `skill_design.md` 中的“技能效果描述”与新版 `buff_design.md` / `assets/data/buffs.json` 的 **数据驱动 Buff 体系**对齐。

### 1.1.1 设计原则

1. **技能只“引用 Buff”，不直接定义 Buff 的运行逻辑**：
   - 技能文档中不再使用“[Buff]/[Debuff] + 一段自由文本”作为唯一规范。
   - 技能只需要声明要施加/移除/刷新哪些 `buffId`（这些 `buffId` 的行为完整定义在 `buffs.json`），以保证低耦合。

2. **Atomic Buff（原子 Buff）优先**：
   - 一个 `buffId` 尽量只描述一个清晰效果（比如“流血 DoT”“减速”“破甲（下一次攻击调整护甲减免）”）。
   - 复杂技能通过“施加多个 Atomic Buff”组合实现，而不是在技能里写特殊逻辑。

3. **触发器/动作以 Buff 为主，技能只负责“施加时机与目标”**：
   - Buff 的触发频率（例如 `onTurnStart` / `onAttackPre` / `onTakeDamagePre`）由 Buff 自身定义。

### 1.1.2 技能文档中的 Buff 引用字段约定（文档层面）

> 本节是“设计文档约定”，用于后续落地成 `skills.json` schema（如果你后续计划更新数据文件）。

- `buffRefs.apply`: 技能成功命中后施加的 Buff 列表
- `buffRefs.applySelf`: 技能释放后对自身施加的 Buff 列表
- `buffRefs.remove`: 技能用于移除的 Buff 列表（如净化）
- `buffRefs.notes`: 仅用于解释该 Buff 的触发点、层数策略或范围（不写运行逻辑）

每个引用项建议具备：
- `buffId`: 必须存在于 `assets/data/buffs.json`
- `target`: `self | enemy`（若需要“部位级”目标，交由 Buff 的 `scope.part`/目标配置表达，技能只负责把“目标对象”传入引擎）
- `stacks`: 可选，若需要技能一次性叠加多层（最终仍受 Buff 的 `lifecycle.maxStacks` 限制）

---

## 1.2 技能平衡标签体系与元数据规范（补充）

本节将 `skill_balance_design.md` 中的“技能分类标签（Skill Tags）”融入技能设计方案，作为技能的**设计语义层**。该层不改变引擎结算，但能显著提升：技能库检索、强度对照、以及 editor 的数据校验能力。

### 1.2.1 基本原则（字段 vs 标签）

- 技能字段（`cost/speed/targetType/requiredPart/buffRefs/effects`）表达的是**运行时事实**（引擎如何结算）。
- `tags/tagMeta` 表达的是**设计语义**（设计意图、用于检索与统计）。
- 两者冲突时，以字段为准；标签用于发现问题与提示修正。

### 1.2.2 数据结构（建议写入 `skills.json`，或由 Skill Editor 维护）

- `tags: string[]`
  - 存放标签枚举。
  - 建议按固定维度顺序书写，便于肉眼扫描（示例见 1.2.6）。
- `tagMeta?: object`
  - 参数化信息（例如固定部位列表、设计备注等）。
  - 不影响引擎结算；主要用于设计说明与编辑器提示。

### 1.2.3 标签维度（稳定枚举，建议写死到编辑器下拉）

1) **作用属性（What it changes）**

- `DMG_HP` / `DMG_ARMOR` / `PIERCE` / `HEAL` / `ARMOR_ADD` / `AP_GAIN` / `SPEED` / `BUFF_APPLY` / `BUFF_REMOVE`

2) **数值类型（Absolute vs Relative）**

- `ABS` / `PCT_MAX` / `PCT_CURRENT` / `SCALING`

3) **生效时间点（Immediate vs Delayed）**

- `INSTANT` / `DELAYED` / `ON_EVENT`

4) **持续周期（Duration / Lifetime）**

- `ONE_SHOT` / `ONE_TURN` / `MULTI_TURN` / `BATTLE` / `PERMANENT`

5) **释放对象（Target Subject / Scope / Selection）**

- Subject：`SUBJECT_SELF` / `SUBJECT_ENEMY` / `SUBJECT_BOTH`
- Scope：`SCOPE_ENTITY` / `SCOPE_PART` / `SCOPE_MULTI_PARTS`
- Selection（可选增强）：`SELECT_FIXED_PART` / `SELECT_RANDOM_PART` / `SELECT_ALL_PARTS`

6) **体系组织（Build / Archetype）**

- 距离：`MELEE` / `RANGED` / `MAGIC`
- 流派：`ARCH_HEAVY` / `ARCH_WALL` / `ARCH_SWORD` / `ARCH_RANGER` / `ARCH_SNIPER` / `ARCH_ELEMENT` / `ARCH_HOLY`

### 1.2.4 可扩展标签（允许新增，但应逐步收敛）

- 条件类：`COND_*`（例如 `COND_TARGET_ARMOR_BROKEN`、`COND_SELF_HP_LT_X`、`COND_STACK_GE_X`、`COND_PREV_SKILL_USED`）
- 玩法偏好类：`COMBO` / `FINISHER` / `SETUP` 等（用于设计沟通，不建议影响结算）

### 1.2.5 与运行时字段的对照（用于校验）

> 下列对照用于“编辑器校验/人工审查”发现：标签与配置是否一致。

- `SUBJECT_SELF` 常见对应：`targetType=SELF` 或 `targetType=SELF_PARTS`，以及 `buffRefs.applySelf` 为主。
- `SUBJECT_ENEMY` 常见对应：`targetType=ENEMY` / `SINGLE_PART` / `ALL_PARTS` / `RANDOM_PART`，以及 `buffRefs.apply` 为主。
- `SCOPE_ENTITY` 常见对应：不要求 `requiredPart`；效果落在 HP/AP/speed 或全局 buff。
- `SCOPE_PART` 常见对应：`targetType=SINGLE_PART` 且存在 `requiredPart`（或运行时能明确一个部位）。
- `SCOPE_MULTI_PARTS` 常见对应：`targetType=ALL_PARTS` 或 `targetType=SELF_PARTS`。
- `SELECT_FIXED_PART` 常见对应：`targetType=SINGLE_PART` + `requiredPart`。
- `SELECT_RANDOM_PART` 常见对应：`targetType=RANDOM_PART`。
- `SELECT_ALL_PARTS` 常见对应：`targetType=ALL_PARTS` 或 `SELF_PARTS`。

### 1.2.6 标签最小完备性（推荐约束）

建议每个技能至少具备：

- 1 个 What
- 1 个 How
- 1 个 When
- 1 个 How long
- `SUBJECT_*` + `SCOPE_*`（必选）
- 1 个距离标签（`MELEE/RANGED/MAGIC`）
- 1 个流派标签（`ARCH_*`）

### 1.2.7 tags 示例（写法示例）

以“破甲打击（对敌单部位）”为例：

- 字段：`targetType=SINGLE_PART`、`requiredPart=chest`
- 标签：
  - `DMG_ARMOR` + `ABS` + `INSTANT` + `ONE_SHOT`
  - `SUBJECT_ENEMY` + `SCOPE_PART` + `SELECT_FIXED_PART`
  - `MELEE` + `ARCH_SWORD`

---

## 2. 技能体系架构 (Skill Architecture)

技能体系主要分为三大主系，下设 7 个具体的战术流派。此外，技能根据获取难度和强度划分为 5 个稀有度等级。

### 2.1 近战系 (Melee Arts) - 钢铁与肉体
强调物理对抗，直接作用于敌人的护甲与肉体。

*   **流派 A: 重装猛攻 (Juggernaut / Smasher)**
    *   *特点*: 高伤害，高 AP 消耗，专注于破甲与控制（示例中主要使用 `buff_stun` / `buff_slow`）。
    *   *核心逻辑*: 依靠蛮力摧毁敌人的防御，为后续攻击打开缺口。
*   **流派 B: 铁壁守卫 (Guardian / Tank)**
    *   *特点*: 护甲堆叠，反击，生存。
    *   *核心逻辑*: 通过 **[护甲回复]** 和 **[格挡]** 承受伤害，利用反击造成伤害。
*   **流派 C: 猩红剑术 (Duelist / Bleeder)**
    *   *特点*: 暴击，流血，多段攻击。
    *   *核心逻辑*: 绕过高护甲部位，或通过 **[流血 (Bleed)]** 造成持续真实伤害。

### 2.2 远程系 (Ranged Arts) - 速度与精准
强调技巧与灵动，擅长点杀特定部位和控制节奏。

*   **流派 D: 极速游侠 (Ranger / Speedster)**
    *   *特点*: 低 AP 消耗，行动力回复，攻速堆叠。
    *   *核心逻辑*: "天下武功唯快不破"，单回合内打出多次攻击，触发多次特效。
*   **流派 E: 精密狙击 (Sniper / Weakness)**
    *   *特点*: 必中，穿透，弱点打击。
    *   *核心逻辑*: 攻击具有 **[弱点 (Weakness)]** 属性的部位时伤害倍增，甚至无视护甲。

### 2.3 魔法系 (Arcane Arts) - 元素与神圣
强调超自然力量，擅长处理复杂战况和改变状态。

*   **流派 F: 元素毁灭 (Elementalist / Nuker)**
    *   *特点*: 属性伤害 (火/冰/雷)，状态异常。
    *   *核心逻辑*: 用现有 `buffs.json` 中的状态近似实现：减速用 `buff_slow`，易伤用 `buff_vulnerable`。燃烧/冻结/感电等效果若未来补齐 Buff 再恢复。
*   **流派 G: 神圣祝祷 (Cleric / Buffer)**
    *   *特点*: 治疗，净化，强力 Buff。
    *   *核心逻辑*: 维持自身健康状态，不仅是回血，更包括 **[净化 Debuff]** 和 **[属性增强]**。

### 2.4 技能稀有度 (Skill Rarity)

技能按稀缺度和强度分为 5 个等级，稀有度越高的技能越难获取（如通过击败 Boss 或精英怪掉落），且通常具有决定性的战场影响力。

*   **Tier 1: 普通 (Common)** - 灰色
    *   基础技能，角色初始携带或在早期关卡大量掉落。通常作为填充 AP 的手段。
*   **Tier 2: 稀有 (Uncommon)** - 绿色
    *   进阶技能，具备一定的特效（如流血、破甲）。是构建流派的基础组件。
*   **Tier 3: 卓越 (Rare)** - 蓝色
    *   核心技能，数值优秀或机制独特。通常决定了玩家战斗风格的走向。
*   **Tier 4: 史诗 (Epic)** - 紫色
    *   强力技能，通常在特定流派中能产生质变效果。获取途径有限（如关卡 20+ 或商店高价购买）。
*   **Tier 5: 传说 (Legendary)** - 金色
    *   终极技能，拥有扭转战局的能力（如无敌、全屏控制）。极其稀有，通常来自 Boss 战利品或隐藏事件。

---

## 3. 详细技能示例 (Skill Examples)

以下提供了完整的技能库示例，分为 **近战**、**远程**、**魔法** 三大系别，包含全部 7 个流派的各稀有度技能。
*(注: AP = 行动点消耗, U = Uncommon, R = Rare, E = Epic, L = Legendary)*

### 3.1 近战系 (Melee Arts)

#### 流派 A: 重装猛攻 (Juggernaut)
*以力破巧，专注于高伤害与硬控制。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **重锤挥击 (Heavy Swing)** | 普通 | 3 | - | 对选中部位造成 120% 物理伤害。若目标该部位护甲 > 0，伤害修正为 130%。 | 基础破甲手段。 |
| **盾牌猛击 (Shield Bash)** | 普通 | 3 | - | 攻击躯干：造成少量伤害，并有 40% 概率对目标施加 `buff_stun`（持续 1 回合）。 | 控制高威胁敌人，打断节奏。 |
| **蛮牛头槌 (Headbutt)** | 普通 | 2 | - | 攻击头部：造成固定物理伤害；同时自身受到少量反噬伤害；并有 25% 概率对目标施加 `buff_stun`。 | 低费控制（有代价）。 |
| **野蛮冲撞 (Savage Charge)** | 稀有 | 4 | 重锤挥击 | 对躯干造成中等伤害。如果此攻击令护甲归零，则额外施加 `buff_slow`（用减速近似“击退”效果）。 | 初始化战场节奏，压制高速敌人。 |
| **碎颅重击 (Skull Cracker)** | 稀有 | 4 | 蛮牛头槌 | 对头部造成 150% 物理伤害。若头部有护甲，额外造成 30 点破甲伤害。 | 针对重头盔敌人的专项打击。 |
| **震荡波 (Shockwave)** | 卓越 | 4 | 野蛮冲撞 | 猛击地面：对目标施加 `buff_slow`（速度 -5，持续 2 回合），并造成少量伤害（可仅作用于躯干或按“全身 AOE=全部位”规则处理）。 | 控制节奏，压制高速敌人。 |
| **处决 (Execute)** | 卓越 | 3 | 碎颅重击 | 只能对 HP < 30% 的目标使用。造成 300% 的巨额真实伤害。 | 斩杀技能，快速结束战斗。 |
| **大地震击 (Earthquake)** | 史诗 | 5 | 震荡波 | 强力打击：对目标造成高额伤害，并有 50% 概率施加 `buff_stun`（持续 1 回合）。 | 强力控制/终结回合。 |
| **诸神黄昏 (Ragnarok)** | 传说 | 6 | 大地震击 | 对所有部位造成毁灭性打击 (200% ATK)，且该攻击具有 100% 的破甲效率。 | 终极毁灭技。 |

#### 流派 B: 铁壁守卫 (Guardian)
*不动如山，擅长防御反击与护甲恢复。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **钢铁意志 (Iron Will)** | 普通 | 2 | - | 立刻恢复躯干和头部 15 点护甲值。 | 紧急维护关键部位。 |
| **格挡 (Block)** | 普通 | 2 | - | 施加 Buff：`buff_block`（减少受到伤害的倍率，持续 1 回合）。 | 预判敌人的高伤单体技能。 |
| **挑衅 (Taunt)** | 普通 | 1 | - | 施加 Debuff：`debuff_weak`（降低攻击力/输出，具体倍率以 `buffs.json` 为准）。 | 低费减伤，填充 AP 间隙。 |
| **重整旗鼓 (Regroup)** | 稀有 | 3 | 钢铁意志 | 恢复所有肢体 (四肢) 10 点护甲值，并解除流血状态。 | 应对 AOE 磨血和 Dot 伤害。 |
| **稳固防线 (Hold the Line)** | 卓越 | 3 | 格挡 | 对自身施加 `buff_shield`（一次性抵挡伤害）与 `buff_block`（持续 1 回合减伤）。 | 简化版的防守爆发。 |
| **压制 (Suppress)** | 卓越 | 3 | 挑衅 | 攻击目标躯干：造成中等伤害，并施加 `debuff_weak`（刷新持续时间）。 | 用输出维持减益覆盖率。 |
| **堡垒姿态 (Fortify)** | 史诗 | 4 | 稳固防线 | 对自身施加 `buff_shield`，并立刻恢复少量护甲值（纯数值效果）。 | 高压回合的生存手段。 |
| **绝对防御 (Aegis)** | 传说 | 5 | 堡垒姿态 | 对自身施加 `buff_shield` + `buff_block`（本回合尽量不受伤）；不再包含“伤害转治疗”的复杂机制。 | 终极保命按钮（简化实现版）。 |

#### 流派 C: 猩红剑术 (Duelist)
*刀刀见血，依靠流血与精准暴击收割敌人。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **血管切割 (Artery Slice)** | 普通 | 2 | - | 攻击四肢。命中后施加 Debuff：`buff_bleed`（DoT，持续/叠层见 `buffs.json`）。 | 基础叠 Dot 手段。 |
| **二连刺 (Double Thrust)** | 普通 | 2 | - | 快速攻击两次，每次造成 60% 伤害。随机选择部位。 | 快速叠加攻击特效。 |
| **佯攻 (Feint)** | 普通 | 1 | - | 对自身施加 `buff_armor_pen`（下一次攻击调整护甲减免系数）。 | 辅助高伤技能，对抗高护甲敌人。 |
| **放血 (Bloodletting)** | 稀有 | 3 | 血管切割 | 攻击躯干。如果敌人已有流血状态，流血层数 +1，并刷新持续时间。 | 维持并加深伤口。 |
| **剑舞 (Blade Dance)** | 稀有 | 3 | 二连刺 | 对随机部位发动 3 次攻击，每次造成 50% 伤害。若全部命中，自身速度 +3。 | 叠流血并提升自身机动性。 |
| **弱点突刺 (Precision Thrust)** | 卓越 | 3 | 佯攻 | 必定暴击 (1.5x)。只能攻击护甲已破损的部位。 | 针对性收割。 |
| **血腥收割 (Bloody Harvest)** | 史诗 | 3 | 放血 | 攻击敌人。若敌人处于流血状态，造成额外 50% 伤害，并结算其剩余流血伤害的 50%。 | 引爆 Dot 造成爆发伤害。 |
| **猩红终结 (Crimson Finale)** | 史诗 | 4 | 剑舞 | 移除目标所有流血层数。每移除一层，造成 30 点真实伤害。 | Dot 流派的终结技。 |
| **千刃风暴 (Thousand Cuts)** | 传说 | 5 | 血腥收割 | 多段攻击；每段命中有概率施加 Debuff：`buff_bleed`（叠层与刷新策略见 `buffs.json`）。 | 瞬间叠满流血层数。 |

---

### 3.2 远程系 (Ranged Arts)

#### 流派 D: 极速游侠 (Ranger)
*天下武功唯快不破，利用高频攻击压制敌人。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **连珠箭 (Quick Shot)** | 普通 | 1 | - | 造成 50% 伤害。不仅低费，而且不占用每回合“仅限一次攻击技能”的限制 (如有)。 | 倾泻多余 AP。 |
| **快步 (Quick Step)** | 普通 | 0 | - | [CD: 3] 本回合速度 +10。 | 抢先手，或触发速度差增益。 |
| **牵制射击 (Distract Shot)** | 普通 | 2 | - | 造成 80% 伤害，并有 25% 概率使目标下回合 AP -1。 | 骚扰敌人节奏。 |
| **战术翻滚 (Tactical Roll)** | 稀有 | 2 | 快步 | 施加 `buff_bless`（用“命中/闪避小幅提升”代替“高闪避+减 AP 消耗”的复杂效果）。 | 低成本提高稳定性。 |
| **疾风箭 (Wind Arrow)** | 稀有 | 3 | 连珠箭 | 必定先手 (Priority +1)。如果比敌人先行动，造成 180% 伤害。 | 利用高速度优势打爆发。 |
| **毒箭 (Poison Arrow)** | 卓越 | 3 | 牵制射击 | 攻击任意部位：造成 80% 伤害，并对目标施加 `buff_poison`（模拟“涂层+后续攻击”的效果，改为一次性施加）。 | 易实现的持续压制。 |
| **肾上腺素 (Adrenaline)** | 卓越 | 0 | 战术翻滚 | 立即获得 2 点 AP，但下回合 AP 上限 -2。 | 透支未来 AP 进行当前爆发。 |
| **极速连击 (Rapid Fire)** | 史诗 | 4 | 疾风箭 | 射出 5 支箭，每支造成 40% 伤害，随机分配给未被破坏的部位。 | 类似于近战的千刃，针对远程。 |
| **压制射击 (Suppressing Fire)** | 史诗 | 4 | 毒箭 | 攻击躯干：造成多段伤害（例如 3 段 40%），并对目标施加 `buff_slow`（刷新持续时间）。 | 通过多段打击稳定控速。 |
| **时空扭曲 (Time Warp)** | 传说 | 6 | 肾上腺素 | 立即获得一个新的回合 (Extra Turn)，但该额外回合只有一半的 AP 上限。 | 极其强大的战术技能。 |

#### 流派 E: 精密狙击 (Sniper)
*一击必杀，专注于穿透与弱点打击。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **弱点标记 (Mark Target)** | 普通 | 2 | - | 施加 `buff_vulnerable`（对象为目标；若未来扩展为“部位易伤”，再拆分为部位级 Buff）。 | 引导伤害，辅助集火。 |
| **稳固瞄准 (Steady Aim)** | 普通 | 2 | - | 对自身施加 `buff_bless`（以现有 buff 近似“命中增益”；暴击增益暂作为纯数值效果或后续新增 Buff）。 | 提升稳定性。 |
| **膝盖射击 (Knee Shot)** | 普通 | 2 | - | 攻击腿部。若造成 HP 伤害，敌人速度 -5 (持续 3 回合)。 | 限制敌人机动性。 |
| **致残射击 (Crippling Shot)** | 稀有 | 3 | 膝盖射击 | 攻击四肢。造成伤害后，使该部位功能失效 (攻击力降低或移动受限)。 | 软控场。 |
| **远程拆解 (Disarm)** | 稀有 | 3 | 弱点标记 | 对手臂造成 200% 的护甲伤害。若护甲被破，敌人攻击力 -30% (1回合)。 | 针对高攻敌人。 |
| **穿甲射击 (Piercing Bolt)** | 卓越 | 3 | 稳固瞄准 | 无视目标 50% 的护甲值直接造成伤害。 | 对抗重甲单位的标准手段。 |
| **爆头 (Headshot)** | 卓越 | 4 | 远程拆解 | 对头部造成 200% 伤害。命中率修正 -20%，但若命中必定暴击。 | 高风险高回报。 |
| **幽灵狙击 (Ghost Snipe)** | 史诗 | 4 | 爆头 | [无法闪避] 且无视 100% 护甲，但也无法暴击。造成固定 150% 面板伤害。 | 稳定且致命的真实伤害。 |
| **精准标记 (Precision Mark)** | 史诗 | 3 | 穿甲射击 | 对目标施加 `buff_vulnerable`（刷新持续时间），并立即对被标记部位造成一次小额伤害（纯数值效果）。 | 集火起手，降低随机性。 |
| **致命一击 (One Shot One Kill)** | 传说 | 6 | 幽灵狙击 | [蓄力] 需要上一回合未使用攻击技能。对目标造成当前 HP 50% 的伤害 (Boss 效果减半)。 | 针对血牛型敌人的终极手段。 |

---

### 3.3 魔法系 (Arcane Arts)

#### 流派 F: 元素毁灭 (Elementalist)
*掌控冰火雷电，大范围杀伤与状态控制。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **奥术飞弹 (Arcane Missile)** | 普通 | 2 | - | 对目标造成魔法伤害（单次命中）。 | 法系基础输出。 |
| **闪电箭 (Lightning Bolt)** | 普通 | 2 | - | 造成 1-30 点随机雷电伤害。若造成最大值，返还 1 AP。 | 赌狗技能，用于补刀。 |
| **迟缓咒 (Slow Hex)** | 普通 | 2 | - | 对目标施加 `buff_slow`（不造成伤害）。 | 纯控制。 |
| **冰锥术 (Ice Lance)** | 稀有 | 3 | 奥术飞弹 | 造成冰霜伤害，并有 50% 概率对目标施加 `buff_slow`。 | 兼顾输出与控速（简化版）。 |
| **奥术弹幕 (Arcane Barrage)** | 稀有 | 3 | 奥术飞弹 | 对随机部位造成多段小额伤害（不施加额外状态）。 | 魔法侧的“多段磨甲”。 |
| **冰霜新星 (Frost Nova)** | 卓越 | 3 | 冰锥术 | 对目标施加 `buff_slow`（刷新持续时间），并造成少量伤害。 | 控速与压制（简化版）。 |
| **元素易伤 (Elemental Vulnerability)** | 卓越 | 2 | 迟缓咒 | 对目标施加 `buff_vulnerable`。 | 为高伤技能铺垫。 |
| **闪电链 (Chain Lightning)** | 史诗 | 4 | 元素易伤 | 对目标随机 3 个部位造成雷电伤害（不再依赖“潮湿/金属盔甲”状态）。 | 稳定的多部位输出。 |
| **雷霆轰击 (Thunder Strike)** | 史诗 | 4 | 元素易伤 | 对目标随机 3 个部位造成雷电伤害。 | 作为法系的“多部位”输出手段。 |
| **陨石术 (Meteor Swarm)** | 传说 | 6 | 雷霆轰击 | 对目标所有部位造成毁灭性伤害（不包含延迟/燃烧/削甲等 Buff 依赖效果）。 | 法系终极多部位输出。 |

#### 流派 G: 神圣祝祷 (Cleric)
*光明的代言人，拥有最强的生存与恢复能力。*

| 技能名称 | 稀有度 | AP | 前置技能 | 效果描述 | 战术用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **圣光术 (Holy Light)** | 普通 | 3 | - | 恢复自身 30 点 HP。 | 基础治疗。 |
| **惩击 (Smite)** | 普通 | 2 | - | 对敌人造成神圣伤害。如果敌人是亡灵/恶魔，伤害翻倍。 | 针对特定种族的输出。 |
| **祝福 (Bless)** | 普通 | 2 | - | 对自身施加 Buff：`buff_bless`（命中/闪避提升，持续时间见 `buffs.json`）。 | 润滑剂，提升稳定性。 |
| **信仰之盾 (Shield of Faith)** | 稀有 | 3 | 圣光术 | 对自身施加 `buff_shield`，并立刻恢复少量 HP（不再依赖“回合结束护甲未破则回血”的触发机制）。 | 持续防御与缓回（简化版）。 |
| **圣盾 (Holy Shield)** | 稀有 | 3 | 祝福 | 对自身施加 `buff_shield`，并立刻回复少量 HP。 | 易实现的强生存。 |
| **净化之火 (Cleansing Fire)** | 卓越 | 3 | 惩击 | 解除自身所有 Debuff，每解除一个，回复 15 点 HP 并对敌人造成等量伤害。 | 攻守兼备的解控技。 |
| **神圣震击 (Holy Shock)** | 卓越 | 3 | 信仰之盾 | 对敌人造成伤害，同时治疗自己等量的生命值。 | 瞬间拉开血量差。 |
| **救赎祷言 (Prayer of Redemption)** | 史诗 | 4 | 圣盾 | 立即恢复大量 HP，并移除自身 `buff_poison` / `buff_bleed`（若引擎支持按 id 移除；否则视为“净化”纯技能效果）。 | 高压回合的重置技能。 |
| **光辉复苏 (Radiant Revitalize)** | 史诗 | 4 | 净化之火 | 立即恢复大量 HP，并对自身施加 `buff_shield`。 | 高压回合的重置按钮。 |
| **审判 (Judgement)** | 传说 | 5 | 光辉复苏 | 对目标造成高额神圣伤害，并施加 `debuff_weak` + `buff_vulnerable`（双 debuff 组合）。 | 神圣系终结技（易实现版）。 |

---

## 4. 技能设计约束 (Design Constraints)

本章节明确了在设计新技能时必须遵守的核心规则，以确保游戏的策略深度与数值平衡。

### 4.1 技能平衡性 (Game Balance)
*   **避免数值碾压**: 技能的强度模型应符合 `强度 = AP消耗 * 稀有度系数` 的基本公式。避免设计出低费高伤且无副作用的技能。
*   **风险与回报**: 高回报技能必须伴随高风险（如自伤、降低防御、下回合行动受限）或高门槛（如苛刻的触发条件、极高的 AP 消耗）。
*   **针对性**: 强力技能应有明显的短板（例如破甲技能对无甲单位低效，单体爆发技能无 AOE 能力），避免出现“万金油”式的无脑最优解。

### 4.2 行动力消耗与策略 (AP & Strategy)
*   **资源管理**: 技能设计应迫使玩家在“当前爆发”与“留存 AP”之间做选择。
*   **低费技能的价值**: 0-1 AP 的技能不应只是填充物，而应具备调整节奏、触发特效或补刀的功能。
*   **高费技能的代价**: 4+ AP 的技能一旦被打断或未命中，应给玩家带来沉重的战术挫败感，因此其收益必须足够诱人。

### 4.3 频率限制 (Usage Frequency)
*   **单回合单次使用**: 核心规则限定 **同名主动技能每回合只能使用一次**。
    *   *设计意图*: 鼓励玩家组建多样化的技能 Build，而不是复读同一个最优技能。
    *   *冷却时间 (CD)*: 对于极强力的技能 (如无敌、全屏 AOE)，除 AP 消耗外，还应设计额外的 CD (2-4 回合) 以防止连续爆发。

### 4.4 机制禁区 (Mechanical Constraints)
*   **不仅限于数值**: 任何 **"回复 AP"** 的技能，其净收益应严格控制，避免无限连动。
*   **实时性剥离**: 不支持 QTE、蓄力条等即时反应机制，保持回合制纯粹的策略规划。
*   **状态控制**: 避免永久硬控 (Perma-Stun)，控制类技能必须有递减机制或免疫期。

### 4.5 游戏特性适配约束 (Game Specific Constraints)
*   **AOE 的重新定义 (Area of Effect in 1v1)**
    *   *背景*: 本游戏采用 1v1 决斗机制 (Duel)，不存在“多名敌人”的概念。
    *   *约束*: 所有的 **AOE (范围伤害)** 技能，其作用对象不是多个单位，而是 **单一目标的所有身体部位** (All Parts)。
    *   *设计*: 例如 "暴风雪" 技能，效果是对敌人的 [头、胸、四肢] 同时造成伤害。这类技能通常用于快速剥离敌人全身护甲，或施加全局 Debuff。
*   **无队友机制 (Solo Combat)**
    *   *背景*: 玩家全程单人作战。
    *   *约束*: 移除所有依赖队友的技能设计。
    *   *设计*: 所有 **辅助/治疗** 技能的目标强制为 **自身 (Self)**。不存在“复活队友”、“光环共享”等机制。
*   **部位依赖与破坏 (Limb Dependency)**
    *   *背景*: 敌人的身体部位会被破坏 (Broken)。
    *   *约束*: 技能在规划阶段 (Planning Phase) 锁定的部位，在结算阶段 (Execution Phase) 可能已经不存在或已损坏。
    *   *设计*: 
        *   **如果目标是特定部位**: 若该部位在技能判定前损毁，技能应 **默认转移至躯干 (Chest)** 或 **判定为丢失 (Miss)** (根据技能类型决定，如精密射击可能Miss，狂乱挥砍则转移)。
        *   **如果目标是全身**: 即使部分部位损毁，技能仍对剩余完好部位生效。

---

## 5. 技能获取与成长系统 (Skill Acquisition & Progression)

本章节详细描述从随机获取模式转型为 **知识点天赋树 (Talent Tree)** 模式的设计方案。

### 5.1 核心资源：知识点 (Knowledge Points - KP)

*   **定义**: 玩家通过冒险获得的用于解锁技能的专用货币。
*   **获取途径**:
    *   **关卡胜利**: 每次战斗胜利获得一定数量 KP (例如: 普通关卡 +1, 精英 +2, boss +5)。
    *   **升级**: 角色等级提升时获得 KP。
    *   **特殊事件**: 某些随机事件可提供额外 KP。

### 5.2 天赋树机制 (Talent Tree Mechanism)

技能不再通过随机三选一获取，而是通过 **天赋面板 (Talent Panel)** 主动解锁。

*   **流派独立**: 7 个流派 (重装、铁壁、剑术等) 各自拥有一条独立的天赋树。
*   **解锁条件 (Unlock Requirements)**:
    1.  **资源足够**: 拥有足够的 KP (Common: 1, Uncommon: 2, Rare: 3, Epic: 5, Legendary: 8)。
    2.  **前置满足**: 必须已解锁该技能的前置节点 (Root 节点无前置)。
*   **树形结构示例**:
    *   Tier 1 (Common) ---> Tier 2 (Uncommon) ---> Tier 3 (Rare) ...
    *   例如: *重锤挥击* (解锁) -> *野蛮冲撞* (可购买)。

### 5.3 交互设计意图 (Interaction Design)

*   **入口**: 在非战斗状态下 (休息点、整备阶段) 可打开技能书。
*   **视觉表现**: 采用传统的连线树状图。已解锁常亮，可解锁高亮闪烁，不可解锁灰显。
*   **策略性**: 玩家必须规划路径，是在一个流派深耕以获取终极技能，还是多流派兼修以获得更多工具。

### 5.4 可行性分析 (Feasibility Analysis)

针对 "随机三选一" 转向 "天赋树" 的方案评估：

#### 1. 数据结构 (Data Structure)
*   **可行性: 高**
*   **改动**:
    *   `skills.json`: 新增字段 `learningCost` (int) 和 `prerequisites` (array of skill_ids).
    *   `Player` 对象: 新增属性 `knowledgePoints` (int) 和 `unlockedSkills` (Set/List).
    *   兼容性: 现有的 `id` 索引结构非常适合做依赖检查。

#### 2. 界面开发 (UI Development)
*   **可行性: 中**
*   **挑战**: 需要开发一个新的 UI 组件 `UI_SkillTree`。
    *   相比简单的列表，树状图需要处理节点位置 (Layout) 和连线绘制 (Canvas/SVG 或 简单的 CSS border)。
    *   **简化方案**: 如果 Canvas 绘制复杂，可以采用 **分层矩阵 (Tiered Matrix)** 布局，用箭头图标指示前置关系，降低开发成本。

#### 3. 游戏体验 (Gameplay Experience)
*   **影响**: 正向。
*   **分析**: 
    *   即时反馈减少 (战斗后没有直接技能奖励)，但长期规划感增强。
    *   符合 WoW 风格的 RPG 深度。
    *   **风险**: 早期如果不给足够的 KP，玩家可能觉得技能太少。需要仔细调整 KP 投放节奏。

#### 4. 结论 (Conclusion)
该方案 **技术上完全可行**，且能显著提升游戏的 RPG 养成深度。建议优先实施 **数据层改造** 和 **基础 UI (简化版树状图)**。

## 6. 技能-Buff 追溯表 (Traceability)

## 6.1 Buff 历史缺口清单（当前示例已规避）

本清单用于对照 `assets/data/buffs.json`，列出“技能设计文档中需要引用，但当前数据中缺失/命名不一致”的 `buffId`。你可以据此判断哪些 Buff 需要新增、哪些应合并为现有 Buff、哪些应该改为“纯技能数值效果（不落 Buff）”。

> 注：以下清单以当前文档中已出现的 `buffId` 为准；同时也包含了你在旧版追溯表中使用、但与新版 `buffs.json` 不一致的命名。

### A. 历史上曾考虑/引用，但 `buffs.json` 当前未见定义（缺失）

（已从当前“技能示例/追溯表”中移除对应设计，避免引用不存在的 `buffId`。若未来需要恢复相关玩法，再考虑在 `buffs.json` 补齐。）

### B. `skill_design.md` 旧追溯表中的命名，与新版 `buffs.json` 不一致（建议统一）

- `buff_weakness`：建议统一为 `debuff_weak`（当前 `buffs.json` 已定义 `debuff_weak`）

### C. 已在 `buffs.json` 存在（无缺口，但需确保技能引用保持一致）

- `buff_bleed`（流血）
- `buff_poison`（中毒）
- `buff_stun`（眩晕）
- `buff_slow`（减速）
- `buff_vulnerable`（易伤/承伤提升）
- `buff_block`（格挡/减伤）
- `buff_shield`（护盾：一次性抵挡）
- `buff_armor_pen`（破甲：通过 `armorMitigationMult` 修正护甲减免）
- `buff_bless`（祝福：命中/闪避）
- `debuff_weak`（虚弱：atk 降低）

---

为了确保技能系统与 Buff 系统的紧密集成，下表仅保留 **C 类（已存在于 `buffs.json`）** 与 **B 类（可通过改名对齐）** 的引用。

> 处理规则：
> - **A 类（缺失 buff）**：对应技能先从追溯表中移除（技能本体仍可保留为“纯技能效果”，但不再声称引用某个不存在的 `buffId`）。
> - **B 类（命名不一致）**：统一命名（例如 `buff_weakness` -> `debuff_weak`）。
> - **C 类（已存在）**：明确引用，避免用错 `buffId`。

| 技能名称 (Skill Name) | 关联 Buff ID | 说明 |
| :--- | :--- | :--- |
| **Artery Slice (血刃切割)** | `buff_bleed` | 命中后对目标施加流血 |
| **Thousand Cuts (千刀风暴)** | `buff_bleed` | 多段命中判定，多次尝试叠加流血 |
| **Bloody Harvest (血腥收割)** | `buff_bleed` | “依赖目标已有流血”的条件判断（Buff 仍为 `buff_bleed`） |
| **Crimson Finale (猩红终结)** | `buff_bleed` | 结算/移除流血层数（移除动作不一定是 Buff，需要引擎支持 removeById；此处仅标明依赖 `buff_bleed`） |
| **Poison Arrow (毒箭)** | `buff_poison` | 命中后对目标施加中毒 |
| **Shield Bash (盾牌猛击)** | `buff_stun` | 命中后对目标施加眩晕 |
| **Headbutt (蛮牛头槌)** | `buff_stun` | 命中后对目标施加眩晕 |
| **Earthquake (地震波)** | `buff_stun` | 概率对目标施加眩晕 |
| **Shockwave (震荡波)** | `buff_slow` | 命中后对目标施加减速 |
| **Knee Shot (膝盖射击)** | `buff_slow` | 命中且造成 HP 伤害后施加减速 |
| **Frost Nova (冰霜新星)** | `buff_slow` | 对目标施加减速并刷新持续时间 |
| **Taunt (嘲讽)** | `debuff_weak` | B 类：统一命名为 `debuff_weak` |
| **Disarm (远程缴械)** | `debuff_weak` | B 类：统一命名为 `debuff_weak`（原 `buff_weakness`） |
| **Mark Target (标记目标)** | `buff_vulnerable` | 命中后对目标施加易伤 |
| **Feint (佯攻)** | `buff_armor_pen` | 对自身施加“下一次攻击护甲减免修正” |
| **Bless (祝福)** | `buff_bless` | 对自身施加命中/闪避增益 |
| **Block (格挡)** | `buff_block` | 对自身施加减伤 |
| **Shield of Faith (信仰之盾)** | `buff_shield` | 对自身施加一次性护盾 |
| **Holy Shield (圣盾)** | `buff_shield` | 对自身施加一次性护盾（神圣系核心生存 Buff） |
| **Steady Aim (稳固瞄准)** | `buff_bless` | 对自身施加命中/闪避增益（用 `buff_bless` 近似实现） |
