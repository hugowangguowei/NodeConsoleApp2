## 网页回合制战斗系统策划案（章节（一））

### 1. 产品定位与体验目标
- **定位**：轻量网页端回合制战斗原型，强调策略规划和部位破甲。
- **体验目标**：玩家需根据敌人护甲分布、行动速度与技能冷却安排行动顺序，用有限行动力创造“破甲→爆发”或“控制→输出”的战术循环。

### 2. 核心玩法循环
1. 回合开始：刷新角色行动力（AP）、技能冷却、自身状态持续回合数。
2. 行动声明：玩家和敌人分别在自身AP范围内选择攻击/技能/防御并指定目标部位，可排定多个动作序列直至AP耗尽或玩家结束回合。
3. 行动排序：根据`角色基础速度 + 动作速度修正`确定执行顺序，速度相同则按上回合逆序或随机打破平局。
4. 行动结算：逐个动作结算伤害、护甲损伤、状态增减、AP消耗；若目标HP≤0则立刻死亡并移出队列。
5. 回合结束：处理持续效果（流血、护盾衰减等），检查任一阵营是否团灭决定胜负，否则进入下一回合。

### 3. 角色与数值模型
- **角色类型**：`PlayerCharacter`、`EnemyCharacter`继承统一`Character`接口，包含HP、最大HP、基础速度、基础AP、抗性（物理/能量/元素）、装备槽和状态容器。
- **部位护甲**：定义护甲部位（头部、胸部、腹部、左臂、右臂、左腿、右腿）、护甲特效（自动修复、反伤、降低速度）、护甲值决定减免百分比，耐久为0则该部位完全暴露。
- **武器**：定义伤害区间、暴击系数、AP消耗、速度修正、命中部位限制以及特殊标签（流血、破甲、穿刺）。
- **技能卡**：以卡片形式描述动作，字段包括AP成本、速度修正、冷却、目标数量/部位规则、效果脚本（伤害/治疗/护甲修复/状态）。
- **状态效果**：统一以`StatusEffect`管理，可叠加或互斥，包含持续回合、触发时机（行动前/后、受击时）及数值（如-30%移动速度、+20护甲）。

### 4. 伤害与防御公式
1. **原始伤害**：由武器基础伤害（可为区间）与技能倍率组成，公式 `Raw = WeaponDamage × SkillMultiplier + BonusFlat`；若存在状态（如易伤+20%）则在此阶段叠加。
2. **命中部位校正**：根据武器或技能的部位系数（如命中头部×1.2、命中四肢×0.8）调整原始伤害，同时记录该部位用于后续护甲结算。
3. **护甲减免**：查询目标部位护甲（基础值 + 临时护甲），按 `Mitigated = Raw × (1 - ArmorPercent)` 执行，护甲耐久按 `Raw × 耐久系数` 递减；若护甲被打穿（耐久≤0）则将 ArmorPercent 置零。
4. **抗性处理**：按伤害类型（物理/能量/元素）应用角色抗性，例如 `Final = Mitigated × (1 - Resistance)`，并在受持续减抗状态时调整 Resistance。
5. **终结效果**：扣减HP，若 HP≤0 触发死亡；携带破甲、流血等标签的技能在此阶段附加耐久削减或状态。
6. **防御与格挡**：防御指令创建临时护甲（固定数值或百分比）并可赋予“格挡次数”。当动作命中被格挡部位时，先消耗格挡次数再进入步骤3；防御还可提供下回合速度修正，鼓励提前防备。

### 5. 行动力与速度设计
- 每回合基础AP由角色成长线决定，可通过技能或状态增减；未使用AP可部分留存（例如最多保留2点）。
- 动作速度：武器与技能各自带速度修正，鼓励“轻武器抢先 → 重武器补刀”的组合。
- 状态对速度的影响直接修改角色基础速度，保证计划性（如减速技能可延后敌人大招）。

### 6. 技能与武器示例
- **武器示例**：
  - `穿甲短剑`：低伤害、低AP、速度+3，命中任意部位且有20%几率造成流血；
  - `重型战锤`：高伤害、AP高、速度-4，对护甲耐久造成额外伤害。
- **技能示例**：
  - `破阵斩`：单体高倍率，附带强制破坏指定部位护甲；
  - `纳米修复`：为一个部位回复耐久并给予1回合减伤；
  - `战术回避`：立即进入防御姿态，下回合速度+2；
  - `连锁射击`：多段攻击不同部位，适合收割裸露部位。

### 7. AI 行为框架
- 使用优先级行为树：
  1. 若自身HP/护甲低于阈值，优先治疗或防御；
  2. 如果玩家存在裸露部位，切换到高伤技能集合；
  3. 若玩家准备高威胁技能（通过读条或状态提示），尝试使用控制/减速技能。
- 行为树支持关卡脚本定制（如某敌人专注破头部、一旦玩家躯干破甲即放终极技能）。

### 8. UI 与反馈
- 战斗界面显示双方HP/AP、部位护甲条与耐久数值；
- 行动排列成时间轴，展示即将执行的动作与速度；
- 日志记录：动作→目标部位→伤害→护甲耐久变化→状态结论，便于玩家复盘；
- 防御状态和技能冷却在角色面板实时更新。

### 9. 测试与迭代计划
- **单元测试**：验证伤害公式、护甲扣减、AP消费、速度排序逻辑；
- **场景测试**：预设“破甲→爆发”“治疗→反击”顺序，确保结果符合设计预期；
- **可玩性迭代**：收集玩家对AP上限、技能冷却、速度影响的反馈，调整数值表；
- **日志审查**：确保所有战斗事件有可追溯记录，便于平衡分析。

### 10. 下一步建议
1. 设计数据表结构（角色、技能、装备、状态）并定义序列化格式；
2. 搭建最小可用回合引擎：包含角色模型、行动排序、伤害结算；
3. 接入简单UI或命令行原型，验证完整回合体验；
4. 根据测试结果补充技能与敌人模板，为章节（二）做准备。
