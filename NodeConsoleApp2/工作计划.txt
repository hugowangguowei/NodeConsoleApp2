我计划开发一个网页游戏；
（一）我想先实现一个简单的回合制战斗系统：
1. 在游戏中，有玩家控制角色和敌人角色两种角色类型；
2. 每个角色都有生命值（HP）的概念，当生命值降为0时，角色死亡；
3. 除生命值之外，角色有着装/护甲/抗性的概念，在有装/护甲/抗性的情况下，角色受到的伤害会显著减少；
4. 护甲跟部位有关，每个部位都有对应的护甲值，可以独立计算伤害减免；
5. 护甲可以被攻击破坏，被破坏的护甲会失去其减免效果；
6. 角色可以装备不同的武器，武器有不同的攻击力和特殊效果；
7. 角色可以使用技能，技能有不同的效果，比如造成伤害、治疗、增加护甲等；
8. 角色的攻击手段（武器/技能）需要选择攻击部位，比如头部/躯干/四肢等，不同部位受到的伤害不同；
9. 角色的攻击手段受行动力限制，每回合有一定的行动力值，攻击手段会消耗不同的行动力；
10.角色可以选择防御（防御是与攻击/技能相同层级的操作）。
11.在每个回合选定行动后，系统会根据角色的速度属性 + 技能的速度属性决定行动顺序，速度高的角色先行动；
12.游戏流程的核心在于针对敌人的特征选择合适的技能顺序。
（二）基于回合制战斗系统，设计敌人生成与关卡系统：

2025-12-28 21:00（编辑）
帮我系统分析一下battle_scene_proposal.md场景接口，并重写这个md文件，我建议方案包括如下章节：
1.场景模块构建目标
2.场景模块设计理念
（作为松耦合的模块，能够以订阅者模式，订阅游戏主流程的事件，能够订阅场景初始化要素）
3.场景模块界面设计
3.1 主要讲述用什么技术栈（比如HTML，canvas,或者webGL)
3.2 对于人物角色，类似于纸娃娃系统的换装、动作系统如何实现
3.3 界面被拆分为什么样的模块？每个模块怎么组成？
3.4 布局样式是什么样的？
4.场景模块接口设计
4.1 主要讲述场景接口的核心设计理念，比如订阅模式监听游戏流程；
4.2 叙述具体要监听哪些事件，事件监听的频率，事件传递的数据结构

2025-12-28 21:20（编辑）
我希望你在design目录下创建core_engine.md文件，对游戏的核心引擎进行设计说明。
该引擎将以JS为主要开发语言。包括以下内容：
1. 帧循环设计；
2. 游戏流程设计（状态机设计）；
3. 事件系统设计（发布-订阅模式）；
4. 数据对象设计（角色对象，物品对象，场景对象等）；
5. 数据管理设计（数据存储，数据加载，数据缓存等）；

在该方案中会清楚地描述从登录，到关卡选择，到对战场景，到胜利失败结算的整个游戏流程。
但是不需要考虑二三维渲染相关的内容。引擎的输入输出可以以文字的形式做规范接口。

2025-12-28 21:40（编辑）
基于core_engine.md的设计，创建游戏引擎，引擎的代码以.js文件的形式储存到script/engine目录下。
创建测试html，放到test目录下，测试html可以通过浏览器打开，测试引擎的基本功能。

2025-12-29 20:50（编辑）
玩家行动中的输入部分需要改一下，在一回合的输入中并不是输入单个技能，而是从技能列表中选择
1-多个技能放入技能待释放区，这个过程可以从技能待释放区取消已选择技能。然后执行“技能配置完成”
功能，这时候敌人根据技能面板同样选择1-多个技能。敌人选择完成后，进入技能释放阶段，双方的技能
按照速度顺序依次释放。在这个过程中，玩家和敌人都不能再更改技能选择。根据这个要求，重新设计7.3 战斗场景 (核心循环)

2025-12-29 23:20（编辑）
我想对DataManager这部分内容，尤其是dataConfig进行深化设计。先不用着急写代码，在core_engine中
新增一个章节，叫做6. 数据配置设计（dataConfig设计）。基于这个章节，设计dataConfig的结构，
使其能够实现游戏状态的实时保存与加载。

2025-12-30 16:22（编辑）
用中文回复。我觉得你对于即时战斗场景的保存有些问题，当前的保存没有记录敌人的初始状态，当前状态，
以及历史回合状态，按照这个模式我载入数据的时候，无法还原到当前战斗过程。
先不着急更改引擎代码，在引擎的设计文档中先明确好你的数据存储方案，尤其是在战斗过程中的数据存储方案。

// 4. 历史记录 (History)这个章节设计的不好，历史记录记的不是数据日志，而应该是过去回合玩家、敌人行为
和结果的合集。请确认这个方案是否合理，如果合理，按照这个思路更新md文件，先不用更新代码。

2025-12-31 00:03（编辑）
我对功能进行了测试，发现了如下问题：在第2或第3回合开始阶段我进行了游戏保存。然后进行重新载入，在重新
载入的游戏下，AP值足够的情况下，技能按钮也是不可点击状态，无法进行技能选择。请你检查一下这个问题，先
不用着急改代码，分析原因。

2025-12-31 21:48（编辑）
我认为当前关卡配置，敌人配置都是写死在代码中的，请确认是否如此，如果确实是写死的，我希望在设计文档提供
一个用JSON配置关卡和敌人的方案。这样我可以通过修改JSON文件来调整关卡和敌人配置，而不需要改动代码。先别
着急改代码，先在设计文档中补充这个方案。

2025-12-31 23:40（编辑）
我希望就当前的v5版本html帮我生成一个UI_design.md文档，在design目录下。文档内容包括：
1. 界面布局设计，包括各个UI模块的位置和大小；
2. 颜色和字体设计，界面的整体风格；
3. 交互设计，用户如何与界面进行交互，比如按钮点击，技能选择等；
4. 接口设计，明确各个UI模块与游戏引擎之间的数据传递接口。

2026-01-01 10:11（编辑）
用中文回复，我对engine_test_v2.html进行了测试，发现了如下问题：
1.敌方玩家现在有护甲描述了比如“head: 20/20 (Armor: 0) | body: 30/30 (Armor: 2)”，但是护甲描述与目标选择
框不匹配，目标选择框中是头部、身体、胸部三个选项，但是护甲描述只有head和body两个部位，请检查一下这个问题。
不要改代码，先分析原因。

2026-01-01 10:42（编辑）
我觉得敌人血量构成的描述方式是错误的。在设计中，血量不会分散到各个部位，而是一个整体的血量值。护甲会分散到
各个部位，每个部位有独立护甲值，护甲值降为0.则扣除血量。请查阅core_engine.md中是否有关于这一项的明确说说明，
如果没有，请补充说明。如果有，请检查代码实现是否符合设计说明。先不要改代码，先分析原因。

2026-01-01 11:42（编辑）
在engine_test_v2中，有两个问题：
1.玩家状态还是用装备来表示各部位，其实现在已经模糊了装备的概念，只有部位护甲的概念，需要更新。
2.现在部位的护甲在界面显示的时候显示的是[Object Object]，检查问题，使其能正常显示

2026-01-01 14:59（编辑）
现在我希望细化UI_design.md中的接口设计章节。要明确每个UI模块与游戏引擎之间的具体数据传递接口。
先从模态框开始设计：
1.明确模态框能够监听引擎运行周期中的哪些事件，这些事件传递的数据结构是什么样的。
2.明确模态框在监听到数据状态后，如何进行处置；
3.明确模态框向引擎传递数据的接口设计，包括接口名称，传递的数据结构等。

2026-01-01 16:28（编辑）
我希望在UI_design.md中增加一个章节,叫做代码设计规范，内容包括：
1.代码要高度的模块化，每个UI模块应该是独立的组件，能够独立开发和测试；
2.代码要有良好的注释，特别是接口部分要有详细的说明，方便后续维护和扩展；
3.每个UI组件都有独立的文件，文件命名要有统一的规范，比如以UI_开头；
4.UI组件的驱动代码要与引擎代码分离，避免耦合过高；
5.不同UI组件之间不直接通信，采用引擎输入，统一管理。

2026-01-02 01:08（编辑）
我认为在已经接入UI_SystemModal.js的情况下，模态窗口能够接收引擎事件。在这个前提下，
一开始模态窗口如果发现引擎处在登录、关卡选择界面，应该自动弹出登录模态窗口或者关卡选择模态窗口。
但是当前并没有这个功能，请你检查一下的代码，分析原因，但是先不要修改代码。

2026-01-02 21:15（编辑）
gameFSM第40、41行先分发，再输出日志，如果分发处理的参数处理过程中产生了新的日志，
在最终输出排序上会显示监听模块改完了状态，状态机才跟着改。这样是否合理？是否符合一般设计标准？
还是需要补充一行日志，例如：“状态改变开始”、“状态改变结束”？先不用着急改代码，帮我分析

2026-01-05 23:15（编辑）
我希望在UI_design.md中增加关于battle-row的接口设计章节，可以与4.4并列。具体内容可以参照4.4 模态窗口接口详解

2026-01-06 23:50（编辑）
我希望在UI_design.md中对skill-panel进行深化设计。请基于core_engine.md中关于技能选择相关的状态机切换以及
交互设计，分析并深化在网页上实现技能选择面板的具体设计方案。包括功能区，布局，交互方法。分析拖拽等交互操作
方式是否可靠稳定。先不用更新写代码，先在设计文档中细化内容。

2026-01-07 23:41（编辑）
我对于4.6的深化设计方案有一些意见。
4.6.2的第一小点，待执行队列，我希望不是一个一维的列表，而是按照攻击部位进行分类的二维列表。所以放在最上方或者下方
不合适，应该跟技能库和动态详情区并列，形成一个三栏布局。这样才能满足玩家对于不同部位技能的选择需求。
4.6.3的交互逻辑，技能入列部分。我希望提供一个基础的设计准则，就是各个大的模块之间尽量不直接交互。
那么“通知场景层高亮这些敌人”这个操作就不十分合理。我认为可以改为高亮待执行队列中的技能占位符
因为在当前设计中只有两个角色，玩家和敌人，所以待执行队列中的技能占位符可以明确区分是玩家技能还是敌人技能。
根据我这个思路，更新4.6章节内容，先不用改代码。
技能除了能够对敌人使用外，还可以对自己使用，比如治疗技能，增益技能等。所以待执行队列中的技能占位符可以分两
大块，左边是玩家待执行队列，右边是敌人待执行队列。例如玩家待执行是n(部位）*1的二维数组，
敌人是m(部位）*3的二维数组（因为面向敌人释放的技能比较多）。请你基于这个思路，更新4.6章节内容，先不用改代码。
设计文档中的“采用 **三栏式布局 (.skill-deck-layout)**，建议比例 `3:5:2`”，我觉得中间部分过宽，建议改为
5:3:2,而且每个技能占位符太大了，可以适当缩小。请你基于这个思路，更新设计文档。

2026-01-08 23:30（编辑）
UI_design 4.6.2 关于待执行队列部分，还需要细化如下：
敌我双方的部位数量默认最大都是8，与玩家状态区的护甲部位数量保持一致。

2026-01-09 23:47（编辑）
在UI_design.md中，对于4.6节，由于该部分交互的内容比较多，除了4.6.3交互逻辑部分，我希望按照
技能库、待执行队列、动态详情区分别设计交互逻辑小节，分别为4.6.4、4.6.5、4.6.6。每个小节都应该明确
该区域接收什么数据驱动，三个区域之间如何进行联动，以及用户如何与该区域进行交互。以及分析该区域交互
操作的结果如何传递给引擎。请你基于这个思路，更新设计文档，先不用改代码。