@charset "UTF-8";
body { margin: 0; background: radial-gradient(circle at top, rgba(78,139,255,0.35), transparent 55%), linear-gradient(160deg, #1f2440, #151a2b); color: #f4f6ff; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
.app-shell { width: 1920px; height: 1080px; background: rgba(32,38,63,0.94); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 60px rgba(8,12,40,0.65); border: 1px solid rgba(120,150,255,0.15); backdrop-filter: blur(6px); max-width: 100%; max-height: 100vh; }
main { flex: 1; padding: 16px 24px; display: grid; grid-template-rows: 546px 286px 186px; gap: 16px; height: calc(1080px - 56px); overflow: visible; }
.scene-wrapper { background: #252b45; border-radius: 18px; padding: 20px 24px 24px; border: 2px solid #81a5ff; box-shadow: 0 18px 36px rgba(6,10,35,0.45); min-height: 0; display: flex; flex-direction: column; overflow: visible; }
.scene-wrapper .area-tag { color: #81a5ff; }
.scene-wrapper .battle-row { height: 100%; flex: 1; }
.battle-row { display: grid; grid-template-columns: 420px 1fr 420px; gap: 16px; min-height: 0; }
.scene-wrapper .battle-row > section { height: 100%; }
.labeled-block { position: relative; }
.area-tag { position: absolute; top: -14px; left: 24px; background: #1f2440; color: #f0f8ff; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.15em; padding: 2px 12px; border-radius: 999px; border: 2px solid currentColor; box-shadow: 0 4px 12px rgba(0,0,0,0.35); }
.sub-area-tag { position: absolute; top: 5px; left: 16px; background: rgba(15,18,30,0.85); color: currentColor; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.12em; padding: 1px 8px; border-radius: 999px; border: 1px solid currentColor; box-shadow: 0 2px 6px rgba(0,0,0,0.25); pointer-events: none; z-index: 2; }
.enemy-hud .sub-area-tag { left: auto; right: 20px; }
.battle-scene .sub-area-tag { left: 50%; transform: translateX(-50%); }
.hud-panel { background: #2f3551; border-radius: 14px; padding: 10px 10px 10px; box-shadow: 0 18px 36px rgba(6,10,35,0.45); display: flex; flex-direction: column; gap: 3px; border: 2px solid rgba(255,255,255,0.08); height: 100%; box-sizing: border-box; overflow-y: auto; overflow-x: hidden; }
.player-hud { border-color: #57c2ff; }
.player-hud .sub-area-tag { color: #57c2ff; }
.hud-panel h2 { margin: 0; font-size: 1.1rem; }
.hud-stat { width: 100%; display: flex; align-items: center; gap: 10px; }
.hud-stat span { font-size: 0.88rem; color: #cbd6ff; min-width: 140px; }
.hud-stat .bar { flex: 1; margin: 0; }
.status-row { display: flex; align-items: center; gap: 12px; font-size: 0.78rem; color: #cbd6ff; }
.status-label { width: 64px; letter-spacing: 0.05em; color: rgba(255,255,255,0.6); }
.status-icons { display: flex; gap: 6px; flex-wrap: wrap; }
.status-icon { width: 20px; height: 20px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); position: relative; cursor: pointer; box-shadow: inset 0 0 6px rgba(0,0,0,0.4); }
.status-icon.buff { background: linear-gradient(135deg, #6ae0ff, #3c7cff); border-color: rgba(101,171,255,0.9); }
.status-icon.debuff { background: linear-gradient(135deg, #ff7b7b, #ff3b3b); border-color: rgba(255,123,123,0.9); }
.status-icon.neutral { background: linear-gradient(135deg, #6c748a, #43495f); border-color: rgba(255,255,255,0.25); }
.status-icon::after { content: attr(data-name) " �� " attr(data-desc); position: absolute; left: 50%; transform: translate(-50%, -110%); background: rgba(9,12,22,0.95); padding: 6px 10px; border-radius: 6px; font-size: 0.72rem; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity .15s ease; box-shadow: 0 6px 16px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); }
.status-icon:hover::after { opacity: 1; }
.player-hud { align-items: flex-start; text-align: left; }
.enemy-hud { align-items: flex-end; text-align: right; }
.enemy-hud .hud-stat { flex-direction: row-reverse; }
.enemy-hud .hud-stat span { text-align: right; }
.enemy-hud .bar span { right: 0; left: auto; }
.enemy-hud .status-row { flex-direction: row-reverse; }
.enemy-hud .status-label { text-align: right; }
.enemy-hud .status-icons { justify-content: flex-end; }
.bar { height: 12px; border-radius: 8px; background: rgba(255,255,255,0.08); margin: 4px 0 12px; position: relative; overflow: hidden; width: 100%; }
.bar span { position: absolute; height: 100%; border-radius: 6px; left: 0; top: 0; }
.hp span { background: linear-gradient(90deg, #ff8e8e, #ff5f5f); width: 80%; box-shadow: 0 0 12px rgba(255,95,95,0.5); }
.ap span { background: linear-gradient(90deg, #7bffcf, #4ff3a0); width: 66%; box-shadow: 0 0 12px rgba(79,243,160,0.4); }
.armor-row { display: flex; align-items: center; gap: 10px; padding: 0px 0; }
.armor-list-wrapper { background: rgba(18,22,38,0.6); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 10px 14px; display: inline-flex; flex-direction: column; gap: 6px; align-self: flex-start; width: auto; max-width: 100%; }
.enemy-hud .armor-list-wrapper { align-self: flex-end; }
.armor-name { min-width: 44px; font-size: 0.78rem; letter-spacing: 0.08em; text-transform: uppercase; color: rgba(255,255,255,0.7); }
.armor-bar { flex: 1 1 160px; width: 180px; height: 6px; border-radius: 999px; background: rgba(255,255,255,0.08); position: relative; overflow: hidden; }
.armor-bar span { position: absolute; top: 0; bottom: 0; left: 0; width: 100%; border-radius: inherit; background: linear-gradient(90deg, #7cf5d9, #57c2ff); }
.armor-value { min-width: 72px; font-size: 0.85rem; font-weight: 600; color: #e5eaff; text-align: right; }
.enemy-hud .armor-value { text-align: left; }
.enemy-hud .armor-bar span { background: linear-gradient(90deg, #ff9dbb, #ff6584); }
.battle-scene { background: #1a1e2e; border-radius: 20px; border: 2px solid #ffd266; position: relative; overflow: hidden; box-shadow: inset 0 0 50px rgba(5,8,25,0.6); padding: 0; height: 100%; box-sizing: border-box; }
.battle-scene .sub-area-tag { color: #ffd266; z-index: 10; }
.stage-background {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  z-index: 1;
  background-image: url('source/scene/%E5%9C%BA%E6%99%AF-001-%E6%A3%AE%E6%9E%97.png');
  background-size: cover;
  background-position: center;
}

.stage-sky {
  display: none;
}

.stage-floor {
  display: none;
}

.fighters-layer {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  gap: 350px;
  z-index: 2;
}

.fighter {
  position: relative;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  width: 240px;
  height: 320px;
  opacity: 1;
  transition: opacity 0.3s ease;
}

.fighter:not(.player-character) {
  /* transform: scaleX(-1); */
}

.character-sprite-container {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sprite-layer {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-size: cover;
  background-position: center;
  transition: transform 0.3s ease;
}

.player-character .sprite-layer.body { 
  background-image: url('source/character/%E4%B8%BB%E8%A7%92-001-%E7%8A%B6%E6%80%81001-%E6%AD%A3%E5%B8%B8%E7%8A%B6%E6%80%81.png'); 
  clip-path: none; 
  box-shadow: none; 
}
.enemy-character .sprite-layer.body { 
  background-image: url('source/character/%E6%95%8C%E4%BA%BA-001-%E7%8A%B6%E6%80%81001-%E6%AD%A3%E5%B8%B8%E7%8A%B6%E6%80%81.png'); 
  clip-path: none; 
  box-shadow: none; 
}

.character-shadow {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  height: 160%;
  background: radial-gradient(circle at top, rgba(0,0,0,0.5), transparent 70%);
  opacity: 0.3;
  z-index: -1;
}

.effect-anchor {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 3;
}

.fx-layer {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 4;
}

/* System Modal Styles */
.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(4px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.modal-backdrop.visible {
  opacity: 1;
  pointer-events: auto;
}

/* Overlay (方案B) */
.overlay-backdrop {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.65);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
  z-index: 9999;
}

.overlay-backdrop.visible {
  opacity: 1;
  pointer-events: auto;
}

.overlay-panel {
  width: min(1400px, 92vw);
  height: min(900px, 88vh);
  background: #1f2440;
  border: 2px solid #81a5ff;
  border-radius: 16px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.8);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.overlay-header {
  padding: 14px 18px;
  background: rgba(129, 165, 255, 0.1);
  border-bottom: 1px solid rgba(129, 165, 255, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.overlay-title {
  margin: 0;
  font-size: 1.1rem;
  color: #fff;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.overlay-close-btn {
  background: none;
  border: none;
  color: #81a5ff;
  font-size: 1.6rem;
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

.overlay-close-btn:hover {
  color: #fff;
}

.overlay-body {
  flex: 1;
  padding: 14px;
  overflow: hidden;
  color: #dce6ff;
}

.modal-panel {
  background: #1f2440;
  border: 2px solid #81a5ff;
  border-radius: 16px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.8);
  width: 600px;
  max-width: 90%;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
  transform: translateY(20px);
  transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  overflow: hidden;
}

.modal-backdrop.visible .modal-panel {
  transform: translateY(0);
}

.modal-header {
  padding: 16px 24px;
  background: rgba(129, 165, 255, 0.1);
  border-bottom: 1px solid rgba(129, 165, 255, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  margin: 0;
  font-size: 1.2rem;
  color: #fff;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.modal-close-btn {
  background: none;
  border: none;
  color: #81a5ff;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

.modal-close-btn:hover {
  color: #fff;
}

.modal-body {
  padding: 24px;
  overflow-y: auto;
  flex: 1;
  color: #dce6ff;
}

.modal-footer {
  padding: 16px 24px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  background: rgba(0, 0, 0, 0.2);
}

/* Skill Tree View (System Modal - 4.4.4) */
.ui-skilltree {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.ui-skilltree__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.04);
}

.ui-skilltree__title {
  font-size: 1rem;
  font-weight: 700;
  color: #fff;
}

.ui-skilltree__kp {
  font-size: 0.9rem;
  color: #7cf5d9;
}

.ui-skilltree__headerActions {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: flex-end;
  margin-left: auto;
}

.ui-skilltree__headerButtons {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.ui-skilltree__headerBtn {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.2s;
}

.ui-skilltree__headerBtn:hover:not(:disabled) {
  border-color: rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, 0.12);
}

.ui-skilltree__headerBtn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.ui-skilltree__headerBtn--primary {
  background: #81a5ff;
  border-color: #81a5ff;
  color: #0b0f1d;
}

.ui-skilltree__headerBtn--primary:hover:not(:disabled) {
  background: #9ab8ff;
  border-color: #9ab8ff;
}

.ui-skilltree__headerBtn--danger {
  background: rgba(255, 95, 95, 0.15);
  border-color: rgba(255, 95, 95, 0.6);
  color: #ff9b9b;
}

.ui-skilltree__headerBtn--danger:hover:not(:disabled) {
  background: rgba(255, 95, 95, 0.25);
  border-color: rgba(255, 95, 95, 0.9);
  color: #ffd2d2;
}

.ui-skilltree__content {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 12px;
  min-height: 520px;
}

.ui-skilltree__canvasWrap {
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 10px;
  background: rgba(0, 0, 0, 0.20);
  overflow: hidden;
  cursor: grab;
}

.ui-skilltree__canvasWrap:active {
  cursor: grabbing;
}

.ui-skilltree__transform {
  position: absolute;
  inset: 0;
  transform-origin: 0 0;
}

.ui-skilltree__connections {
  position: absolute;
  inset: 0;
  width: 2000px;
  height: 2000px;
  pointer-events: none;
}

.ui-skilltree__nodes {
  position: absolute;
  inset: 0;
  width: 2000px;
  height: 2000px;
}

.ui-skilltree__line {
  fill: none;
  stroke: rgba(255, 255, 255, 0.18);
  stroke-width: 2;
}

.ui-skilltree__node {
  position: absolute;
  width: 83px;
  height: 83px;
  display: grid;
  grid-template-rows: 1fr auto;
  align-items: center;
  justify-items: center;
  padding: 10px;
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.06);
  color: #fff;
  cursor: pointer;
  user-select: none;
}

.ui-skilltree__node:hover {
  border-color: rgba(255, 255, 255, 0.22);
  background: rgba(255, 255, 255, 0.08);
}

.ui-skilltree__node.is-selected {
  outline: 2px solid rgba(255, 210, 102, 0.95);
  box-shadow: 0 0 0 4px rgba(255, 210, 102, 0.16);
}

.ui-skilltree__nodeName {
  width: 100%;
  font-size: 0.85rem;
  font-weight: 800;
  line-height: 1.1;
  text-align: center;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
}

.ui-skilltree__nodeMeta {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.92);
  background: rgba(0, 0, 0, 0.28);
  border: 1px solid rgba(255, 255, 255, 0.14);
  border-radius: 999px;
  padding: 3px 10px;
}

/* Node states */
.ui-skilltree__node--locked {
  opacity: 0.55;
  border-color: rgba(255, 255, 255, 0.10);
  background: rgba(255, 255, 255, 0.04);
}

.ui-skilltree__node--learnable {
  border-color: rgba(129, 165, 255, 0.75);
  background: rgba(129, 165, 255, 0.12);
  box-shadow: 0 0 0 3px rgba(129, 165, 255, 0.14);
}

.ui-skilltree__node--learnable:hover {
  border-color: rgba(129, 165, 255, 0.92);
  background: rgba(129, 165, 255, 0.16);
}

.ui-skilltree__node--learned {
  border-color: rgba(124, 245, 217, 0.70);
  background: rgba(124, 245, 217, 0.10);
}

.ui-skilltree__node--learned:hover {
  border-color: rgba(124, 245, 217, 0.90);
  background: rgba(124, 245, 217, 0.14);
}

.ui-skilltree__node--insufficient_kp {
  border-color: rgba(255, 210, 102, 0.75);
  background: rgba(255, 210, 102, 0.10);
  opacity: 0.85;
}

.ui-skilltree__node--exclusive_lock {
  border-color: rgba(255, 95, 95, 0.75);
  background: rgba(255, 95, 95, 0.08);
  opacity: 0.75;
}

.ui-skilltree__detail {
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.04);
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.ui-skilltree__detailTitle {
  font-size: 1rem;
  font-weight: 800;
  color: #fff;
}

.ui-skilltree__detailDesc {
  font-size: 0.85rem;
  color: rgba(220, 230, 255, 0.95);
  line-height: 1.35;
  white-space: pre-wrap;
}

.ui-skilltree__detailRow {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  font-size: 0.85rem;
}

.ui-skilltree__label {
  color: rgba(255, 255, 255, 0.65);
}

.ui-skilltree__value {
  color: rgba(255, 255, 255, 0.95);
  text-align: right;
}

.ui-skilltree__actions {
  display: flex;
  gap: 10px;
}

.ui-skilltree__detailHint {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.65);
}

.ui-skilltree__footer {
  display: flex;
  justify-content: flex-end;
}

/* Specific View Styles */
.menu-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.menu-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 16px;
  color: #fff;
  font-size: 1rem;
  text-align: left;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.menu-btn:hover {
  background: rgba(129, 165, 255, 0.2);
  border-color: #81a5ff;
  padding-left: 24px;
}

.level-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 16px;
}

.level-card {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s;
}

.level-card:hover {
  border-color: #7cf5d9;
  background: rgba(124, 245, 217, 0.1);
}

.level-card h4 { margin: 0 0 8px 0; color: #fff; }
.level-card p { margin: 0; font-size: 0.8rem; color: #aaa; }

.save-slot {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.save-slot-info h4 { margin: 0 0 4px 0; color: #fff; }
.save-slot-meta { font-size: 0.8rem; color: #888; }

.slot-actions { display: flex; gap: 8px; }

.btn-primary {
  background: #81a5ff;
  color: #000;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.btn-danger {
  background: rgba(255, 95, 95, 0.2);
  color: #ff5f5f;
  border: 1px solid #ff5f5f;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
}

/* Floating Menu Button */
.system-menu-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #2c3350;
  border: 2px solid #81a5ff;
  color: #fff;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 900;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  transition: transform 0.2s;
}

.system-menu-btn:hover {
  transform: rotate(90deg);
}

@keyframes idle { 0%, 100% { transform: translateY(0) scaleY(1); } 50% { transform: translateY(-5px) scaleY(1.02); } }
.enemy-character { animation-delay: 1s; }
/* Action Panel & Skill Deck Common */
.action-panel { background: #2c3350; padding: 6px 10px 6px; border-radius: 14px; display: flex; gap: 16px; box-shadow: 0 15px 30px rgba(6,10,35,0.45); min-height: 0; border: 2px solid #7cf5d9; }
.action-panel .area-tag { color: #7cf5d9; }

/* REFACTORED SKILL PANEL (3-Column Layout) */
.skill-panel { flex: 9; display: flex; gap: 12px; }

.skill-pool-column {
  flex: 5; /* 50% */
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: rgba(12,16,32,0.65);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 14px;
  padding: 12px;
  min-width: 0;
  box-shadow: inset 0 0 16px rgba(0,0,0,0.25);
}

.action-matrix-column {
  flex: 3; /* 30% */
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: rgba(12,16,32,0.65);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 14px;
  padding: 4px;
  min-width: 0;
}

.skill-detail-column {
  flex: 2; /* 20% */
  display: flex;
  flex-direction: column;
  gap: 10px;
  min-width: 0;
}

.column-header {
  font-size: 0.9rem;
  color: #7cf5d9;
  letter-spacing: 0.1em;
  text-align: center;
  margin-bottom: 4px;
  text-transform: uppercase;
  flex-shrink: 0;
}

/* Skill Grid View (Modified for Pool Column) */
.skill-grid-view {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(auto-fill, 55px);
  grid-auto-rows: 55px;
  gap: 8px;
  justify-content: start;
  overflow-y: auto;
  padding-right: 4px;
}
.skill-grid-view::-webkit-scrollbar { width: 4px; }
.skill-grid-view::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

.skill-icon-button {
  width: 100%;
  height: 100%;
  border: 1px solid #4a4a4a; 
  border-radius: 4px; 
  background: radial-gradient(circle at center, #3a4055, #1a1e2e);
  cursor: pointer; 
  transition: all .15s ease;
  position: relative;
  overflow: hidden;
  padding: 0;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.5), 0 2px 4px rgba(0,0,0,0.3);
}

/* Rarity Borders */
.skill-icon-button.rarity-common { border-color: #9e9e9e; }
.skill-icon-button.rarity-uncommon { border-color: #4caf50; }
.skill-icon-button.rarity-rare { border-color: #2196f3; box-shadow: inset 0 0 6px rgba(33, 150, 243, 0.3); }
.skill-icon-button.rarity-epic { border-color: #9c27b0; box-shadow: inset 0 0 6px rgba(156, 39, 176, 0.3); }
.skill-icon-button.rarity-legendary { border-color: #ff9800; box-shadow: inset 0 0 6px rgba(255, 152, 0, 0.3); }

.skill-icon-button:hover {
  filter: brightness(1.2);
  transform: scale(1.05); 
  z-index: 2;
}
.skill-icon-button.active {
  border-color: #ffd700;
  box-shadow: 0 0 8px rgba(255, 215, 0, 0.8), inset 0 0 0 1px rgba(255, 215, 0, 0.3);
}

.skill-icon-button.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(100%);
}
.skill-icon-button.disabled .skill-badge-ap {
    color: #ff4d4d;
}

/* New Inner Elements */
.skill-badge-ap {
  position: absolute;
  top: 2px;
  right: 3px;
  font-size: 11px;
  font-weight: bold;
  color: #ffd700;
  text-shadow: 1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
  line-height: 1;
  z-index: 2;
}

.skill-icon-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -60%);
  font-size: 24px;
  line-height: 1;
  z-index: 1;
}

.skill-name-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.75);
  color: #fff;
  font-size: 10px;
  line-height: 16px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 0 2px;
  box-sizing: border-box;
  z-index: 2;
}

.enemy-part-missing .enemy-zone {
    opacity: 0.3;
    pointer-events: none;
    background: repeating-linear-gradient(
        45deg,
        rgba(0,0,0,0.2),
        rgba(0,0,0,0.2) 10px,
        rgba(0,0,0,0.4) 10px,
        rgba(0,0,0,0.4) 20px
    );
}

.disabled-zone {
    pointer-events: none;
}

.highlight-valid {
    background: rgba(124, 245, 217, 0.2);
    border-color: #7cf5d9;
    box-shadow: 0 0 8px rgba(124, 245, 217, 0.4);
    animation: pulse-border 1.5s infinite;
}

@keyframes pulse-border {
    0% { border-color: rgba(124, 245, 217, 0.6); }
    50% { border-color: rgba(124, 245, 217, 1); box-shadow: 0 0 12px rgba(124, 245, 217, 0.6); }
    100% { border-color: rgba(124, 245, 217, 0.6); }
}

.slot-placeholder.filled {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    font-size: 0.82rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    display: flex;
    align-items: center;
    justify-content: center;
    border-color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.filled.type-damage, .filled.type-offense { color: #ff5f5f; border-color: #ff5f5f; }
.filled.type-heal, .filled.type-defense { color: #57c2ff; border-color: #57c2ff; }
.filled.type-buff, .filled.type-support { color: #ffd266; border-color: #ffd266; }

/* Sort Bar */
.skill-sort-bar {
  display: flex; gap: 4px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.08);
  flex-shrink: 0;
}
.sort-btn {
  flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
  color: #8fa3bf; font-size: 0.7rem; padding: 4px; border-radius: 4px;
  cursor: pointer; transition: all 0.2s;
}
.sort-btn:hover, .sort-btn.active {
  background: rgba(124, 245, 217, 0.1); color: #7cf5d9; border-color: #7cf5d9;
}

/* Action Matrix Styles */
.action-matrix-container {
  display: flex;
  flex-direction: column;
  gap: 1px;
  flex: 1;
  overflow-y: auto;
}
.matrix-row {
  display: grid;
  grid-template-columns: calc(var(--matrix-self-max, 2) * 35px + (max(0, (var(--matrix-self-max, 2) - 1)) * 8px) + 12px) 24px 1fr;
  align-items: center;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 8px;
  gap: 12px;
}
.matrix-label {
  width: 24px;
  color: #8fa3bf;
  font-size: 0.75rem;
  text-align: center;
  writing-mode: vertical-lr; /* Vertical text for label */
  letter-spacing: 0.2em;
  opacity: 0.7;
}

.matrix-zone {
  display: flex;
  gap: 8px;
  align-items: center;
}
.self-zone {
  flex: 0 0 auto;
  padding-right: 12px;
  border-right: 1px solid rgba(255,255,255,0.1);
}
.enemy-zone {
  flex: 1;
  justify-content: flex-start;
}

.slot-placeholder {
  width: 35px;
  height: 35px;
  background: rgba(0,0,0,0.2);
  border: 1px dashed rgba(255,255,255,0.2);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
.slot-placeholder:hover {
  background: rgba(255,255,255,0.05);
  border-color: rgba(255,255,255,0.6);
}

/* Compact Detail Styles */
.skill-detail {
  flex: 1 !important;
  background: rgba(14,18,32,0.8);
  border: 1px solid rgba(124,245,217,0.25);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.45);
  display: flex;
  flex-direction: column;
  gap: 6px;
  overflow: hidden;
}
.compact-detail h4 { margin: 0; font-size: 0.9rem; color: #f5f7ff; }
.compact-detail .detail-meta { font-size: 0.7rem; color: #a8c2ff; margin-bottom: 4px; }
.compact-detail .detail-body { font-size: 0.75rem; line-height: 1.3; color: #dce6ff; margin: 2px 0; }
.compact-detail .detail-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: auto; }
.compact-detail .detail-tags span { background: rgba(124,245,217,0.1); border: 1px solid rgba(124,245,217,0.2); color: #7cf5d9; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; }

.turn-panel { flex: 1; background: rgba(15,20,35,0.85); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 16px; box-shadow: 0 12px 24px rgba(0,0,0,0.45); display: flex; flex-direction: column; gap: 12px; justify-content: center; align-items: stretch; }
.turn-panel h4 { margin: 0; font-size: 0.95rem; letter-spacing: 0.08em; color: #f7fbff; text-align: center; }
.turn-buttons { display: flex; flex-direction: column; gap: 10px; }
.turn-button { background: linear-gradient(135deg, #1f2540, #2f3b64); border: 2px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 12px; font-size: 0.9rem; font-weight: 600; letter-spacing: 0.08em; color: #f4f8ff; cursor: pointer; transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease; }
.turn-button:hover { transform: translateY(-2px); border-color: #7cf5d9; box-shadow: 0 10px 20px rgba(0,0,0,0.35); }
.turn-button.primary { background: linear-gradient(135deg, #4ff3a0, #2cd978); color: #0b1a16; border-color: rgba(76,240,167,0.6); }
.turn-button.secondary { background: linear-gradient(135deg, #6c748a, #4a5475); color: #e5eaff; border-color: rgba(255,255,255,0.2); }
.turn-button.neutral { background: transparent; border: 1px solid rgba(255,255,255,0.1); color: #8fa3bf; }
.turn-button.warning { background: linear-gradient(135deg, #ffb347, #ff6a00); color: #301400; border-color: rgba(255,145,0,0.6); }
/* Disabled State */
.turn-button[disabled], .turn-button.disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; filter: grayscale(0.8); }
.timeline { position: relative; background: rgba(28,32,54,0.96); padding: 10px 12px; border-radius: 12px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 12px 28px rgba(5,9,30,0.35); border: 2px solid #c08bff; margin-bottom: 12px; min-height: 128px; }
.timeline .sub-area-tag { color: #c08bff; z-index: 1; }
.timeline-head { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
.timeline-meta { display: flex; align-items: center; gap: 8px; color: #d6bcff; font-size: 0.74rem; }
.timeline-controls { display: flex; align-items: center; gap: 6px; }
.timeline-controls button,
.timeline-controls select { background: rgba(20,24,42,0.9); color: #e9ddff; border: 1px solid rgba(192,139,255,0.35); border-radius: 6px; padding: 3px 8px; font-size: 0.72rem; }
.timeline-controls button[disabled] { opacity: 0.5; cursor: not-allowed; }

/* ATB Track */
.timeline-track {
  position: relative;
  border: 1px solid rgba(192,139,255,0.10);
  border-radius: 8px;
  padding: 4px 8px 8px;
  background: rgba(19,22,39,0.55);
}

.timeline-track {
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}

.timeline-track-layer {
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

.timeline-axis-canvas {
  display: block;
  width: 100%;
  height: 100%;
}

.timeline-node-layer {
  position: relative;
  z-index: 1;
  min-height: 68px;
  overflow: hidden;
}

.timeline-ruler,
.timeline-tick,
.timeline-tick-label {
  display: none;
}

.timeline-list {
  display: none;
}

.timeline-empty { color: #bcaad8; font-size: 0.74rem; padding: 6px 0; }

/* Skill bubble node */
.timeline-item {
  position: absolute;
  bottom: auto;
  z-index: 1;
  width: 42px;
  height: 42px;
  border-radius: 8px;
  border: 1px solid rgba(140,157,255,0.55);
  background: linear-gradient(160deg, rgba(56,64,108,0.96), rgba(35,41,76,0.96));
  color: #edf1ff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  padding: 4px 3px;
  text-align: center;
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
  transform: translateX(-50%);
  transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
}
.timeline-item:hover { transform: translateX(-50%) translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.42); }

.timeline-item::after {
  content: "";
  position: absolute;
  left: 50%;
  bottom: -8px;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 8px solid rgba(140,157,255,0.85);
}

.timeline-item-side {
  position: absolute;
  top: -7px;
  left: 3px;
  border-radius: 999px;
  font-size: 0.5rem;
  padding: 1px 4px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(12,14,26,0.95);
}
.timeline-item-side.self { color: #79f4cb; }
.timeline-item-side.enemy { color: #ffb7b7; }

.timeline-item-icon { font-size: 0.78rem; line-height: 1; }
.timeline-item-title {
  font-size: 0.52rem;
  line-height: 1.05;
  font-weight: 600;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.timeline-item-sub {
  font-size: 0.48rem;
  color: #cdd5ff;
  line-height: 1;
}

/* State colors */
.timeline-item.is-running,
.timeline-item.is-current {
  border-color: #ffe294;
  box-shadow: 0 0 0 2px rgba(255,226,148,0.28), 0 10px 20px rgba(0,0,0,0.42);
}
.timeline-item.is-running::after,
.timeline-item.is-current::after {
  border-top-color: #ffe294;
}
.timeline-item.is-done {
  border-color: rgba(124,245,217,0.75);
  background: linear-gradient(160deg, rgba(42,92,86,0.95), rgba(28,62,58,0.95));
}
.timeline-item.is-done::after {
  border-top-color: rgba(124,245,217,0.85);
}
.timeline-item.is-error {
  border-color: rgba(255,115,115,0.8);
  background: linear-gradient(160deg, rgba(100,48,48,0.95), rgba(72,34,34,0.95));
}
.timeline-item.is-error::after {
  border-top-color: rgba(255,115,115,0.88);
}
.timeline-item.is-selected {
  box-shadow: 0 0 0 2px rgba(120,245,255,0.32), 0 10px 20px rgba(0,0,0,0.42);
}

.timeline-log-list { margin: 0; padding: 0 0 0 16px; color: #b7c2f2; font-size: 0.66rem; max-height: 52px; overflow: auto; }
footer { padding: 0 24px 24px; color: #b5c1ff; font-size: 0.85rem; flex-shrink: 0; height: 56px; display: flex; align-items: flex-end; }
