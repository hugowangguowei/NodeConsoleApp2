# 高光回答

## 26-02-25

### 问题：基于插槽的单选/多选技能放置，交互流程与数量约束应如何设计？

**背景要点**
- 当前流程均为：点击技能 → 点击插槽 → 完成选择，但存在两个关键缺口：
  1) 单选技能放置后仍可继续点击更多插槽（不合理；应结束或替换）。
  2) 多选技能未记录“已放置数量/上限”，导致可无限占据槽位。

**答案（推荐方案）**
将“放置”建模为一次明确的 **会话（placement session）**，用一个小型状态机统一单选/多选逻辑，并把“上限/替换/取消”规则集中起来。

1) **引入放置会话状态**（UI 层/临时态即可）
- `activeSkillId`：当前正在放置的技能
- `placementMode`：`SINGLE | MULTI`
- `maxPlacements`：本次允许占用的插槽数（单选=1；多选=配置上限）
- `selectedSlotKeys`：本次会话里已选择的插槽集合（用稳定 `slotKey` 标识）

2) **单选技能（SINGLE）的点击规则**
- 点击空插槽：放置到该插槽后，**会话立即结束**（自动退出放置模式）。
- 点击另一个空插槽：执行 **替换**（移除原插槽放置 → 放到新插槽），始终只保留 1 个。
- 点击已放置的同一插槽：视作 **取消**（移除放置；是否结束会话可按体验取舍，但要一致）。

3) **多选技能（MULTI）的点击规则**
- 点击空插槽：若 `selectedSlotKeys.size < maxPlacements` 则放置；达到上限后禁止继续放置并提示原因。
- 点击已在 `selectedSlotKeys` 中的插槽：视作 **取消该槽位的本次放置**（移除并释放计数）。
- 点击已被“其他技能/既有配置”占用的插槽：建议二选一并全局一致：
  - **禁止覆盖**：提示槽位已占用；
  - **允许覆盖**：先移除原占用再放置（会影响其它技能配置，风险更大）。

4) **上限的来源建议**
- 单选：固定为 1。
- 多选：从技能元数据或战斗规则读取，例如 `maxPlacementsPerTurn` / `maxSlots`（命名需与现有字段统一）。

5) **为什么这是系统性的**
- 行为语义集中在同一状态机里，避免 UI 事件散落条件判断；
- 便于后续把同一规则迁移到引擎层做校验，与现有“槽位容量约束”保持一致。
